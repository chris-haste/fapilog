# Story 10.2: Pretty Console Output for Development

## Status: Planned

## Priority: Medium

## Estimated Effort: Small (1 day)

## Dependencies

- **Depends on:** Story 10.1 (Configuration Presets) - Uses preset system

## Epic / Series

Part of Epic 10: Developer Experience and Ergonomics / Series 10.x

---

## Context / Background

During local development, JSON logs are hard to scan. A readable, colored console format should be available by default in dev preset or when output is a TTY.

## Scope (In / Out)

### In Scope

- Pretty formatter with colors and inline key-value output.
- TTY-aware default behavior with a `format` option (auto, json, pretty).
- Ability to disable colors for CI or user preference.
- Tests for formatting, TTY detection, and color toggles.

### Out of Scope

- Replacing JSON output for production sinks.
- New third-party formatting dependencies unless strictly necessary.

## Acceptance Criteria

1. Pretty formatter renders timestamp, level, message, and key-value fields.
2. Colored levels: ERROR red, WARNING yellow, INFO blue, DEBUG gray.
3. `format="auto"` selects pretty when stdout is a TTY, JSON otherwise.
4. `format="pretty"` and `format="json"` override auto behavior.
5. `pretty_colors=False` disables ANSI codes.
6. Pretty formatting only applies to stdout sink; JSON sinks are untouched.
7. dev preset uses pretty by default; production preset uses JSON.
8. Tests cover formatting and TTY behavior.

## Implementation Notes

- Add a new `stdout_pretty` sink or a formatter helper used by stdout output.
- Keep performance by avoiding extra serialization for JSON sinks.
- Assumption: ANSI color codes are acceptable and can be disabled.

## Tasks

- [ ] Implement pretty formatter utilities in a new module (for example `src/fapilog/core/formatting.py`).
- [ ] Add a `StdoutPrettySink` in `src/fapilog/plugins/sinks/` or extend `stdout_json` with a format switch.
- [ ] Add settings for stdout format and colors in `src/fapilog/core/settings.py` (new sink config entry if needed).
- [ ] Wire preset defaults (dev uses pretty, production uses json).
- [ ] Update docs with output examples and configuration flags.
- [ ] Add tests in `tests/unit/test_stdout_json_sink.py` or a new `tests/unit/test_stdout_pretty_sink.py`.

## Tests

- Unit: pretty formatter output includes timestamp, level, message, and key-values.
- Unit: color toggle disables ANSI codes.
- Unit: TTY detection respects `format="auto"`.
- Regression: JSON stdout formatting unchanged when `format="json"`.

## Definition of Done

Story is complete when ALL of the following are true:

### Code Complete
- [ ] All acceptance criteria met and verified
- [ ] All tasks completed
- [ ] Code follows project style guide
- [ ] No linting errors or warnings
- [ ] Type checking passes (mypy strict)

### Quality Assurance
- [ ] Unit tests: >90% coverage of new code
- [ ] Integration tests: all scenarios passing
- [ ] Regression tests: no existing functionality broken
- [ ] Performance tests: no regression vs baseline
- [ ] Manual testing completed (if applicable)

### Documentation
- [ ] User-facing docs updated
- [ ] API reference updated (if applicable)
- [ ] Code examples added/updated
- [ ] CHANGELOG.md updated
- [ ] Inline code documentation complete

### Review & Release
- [ ] Code review approved
- [ ] Documentation reviewed for clarity
- [ ] CI/CD pipeline passing
- [ ] Ready for merge to main branch

### Backwards Compatibility
- [ ] No breaking changes OR breaking changes documented with migration guide
- [ ] Existing tests still pass
- [ ] Deprecation warnings added (if applicable)

---

## Risks / Rollback / Monitoring

### Risks

- **Risk:** Formatting inconsistencies across terminals
  - **Mitigation:** Test on multiple terminals, provide fallback modes

- **Risk:** Performance impact from formatting
  - **Mitigation:** Benchmark, optimize formatting code

### Rollback Plan

- Keep new sink isolated
- Switch preset defaults back to JSON
- Remove pretty formatter if needed

### Success Metrics / Monitoring

- User feedback on readability
- Performance benchmarks
- Adoption metrics

---

## Related Documents

- [Story 10.0: Series Overview](./10.0-series-overview.md)
- [Story 10.1: Configuration Presets](./10.1.configuration-presets.md)
- [Epic 10: Developer Experience](../prd/epic-10-DX-Experience.md)

---

## Change Log

| Date       | Change                    | Author |
| ---------- | ------------------------- | ------ |
| 2025-01-10 | Migrated to new format    | System |
