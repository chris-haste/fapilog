# Story 10.7: Fluent Builder API

## Status: Planned

## Priority: Medium

## Estimated Effort: Medium (2-3 days)

## Dependencies

- **Depends on:** Story 10.1 (Configuration Presets) - Builder uses preset system

## Epic / Series

Part of Epic 10: Developer Experience and Ergonomics / Series 10.x

---

## Context / Background

Some users prefer a discoverable, chainable builder pattern for configuration. A fluent builder should provide IDE-friendly method chaining without creating a new configuration model.

## Scope (In / Out)

### In Scope

- `LoggerBuilder` and `AsyncLoggerBuilder` with chainable methods.
- Builder methods to configure level, presets, context, redaction, and sinks.
- Validation on `build()` with clear error messages.

### Out of Scope

- A new configuration system that replaces Settings.
- Additional sink types beyond what already exists.

## Acceptance Criteria

1. `LoggerBuilder` supports chaining and returns a logger via `build()`.
2. `AsyncLoggerBuilder` supports `build_async()` and awaits setup.
3. Builder methods cover: level, preset, context, redaction, enrichers, filters, queue/batch settings, and common sinks.
4. Builder validates invalid combinations at build time with clear errors.
5. Builder is thin sugar over Settings and `get_logger`.
6. Docs include examples comparing Settings and Builder usage.
7. Tests cover chaining, validation, and output configuration.

## Implementation Notes

- Add builder classes in `src/fapilog/builder.py` or `src/fapilog/core/builder.py`.
- Export builders from `src/fapilog/__init__.py`.
- Assumption: builder accumulates Settings-compatible dicts and then calls `get_logger`.

## Tasks

- [ ] Implement `LoggerBuilder` with chainable methods and Settings assembly.
- [ ] Implement `AsyncLoggerBuilder` with `build_async()`.
- [ ] Add method coverage for sink helpers (file, stdout, http, webhook, cloudwatch, loki, postgres).
- [ ] Add validation for invalid combinations (for example, file sink without path).
- [ ] Update docs with builder examples and guidance.
- [ ] Add tests in `tests/unit/test_public_api_init.py` and new builder tests in `tests/unit/test_builder_api.py`.

## Tests

- Unit: chaining returns self and builds a logger.
- Unit: invalid configs raise clear errors.
- Unit: builder settings map to Settings fields accurately.
- Integration: async builder returns a working async logger.

## Definition of Done

Story is complete when ALL of the following are true:

### Code Complete
- [ ] All acceptance criteria met and verified
- [ ] All tasks completed
- [ ] Code follows project style guide
- [ ] No linting errors or warnings
- [ ] Type checking passes (mypy strict)

### Quality Assurance
- [ ] Unit tests: >90% coverage of new code
- [ ] Integration tests: all scenarios passing
- [ ] Regression tests: no existing functionality broken
- [ ] Performance tests: no regression vs baseline
- [ ] Manual testing completed (if applicable)

### Documentation
- [ ] User-facing docs updated
- [ ] API reference updated (if applicable)
- [ ] Code examples added/updated
- [ ] CHANGELOG.md updated
- [ ] Inline code documentation complete

### Review & Release
- [ ] Code review approved
- [ ] Documentation reviewed for clarity
- [ ] CI/CD pipeline passing
- [ ] Ready for merge to main branch

### Backwards Compatibility
- [ ] No breaking changes OR breaking changes documented with migration guide
- [ ] Existing tests still pass
- [ ] Deprecation warnings added (if applicable)

---

## Risks / Rollback / Monitoring

### Risks

- **Risk:** Builder diverges from Settings behavior over time
  - **Mitigation:** Keep builder implementation minimal and derived from Settings

- **Risk:** Builder API becomes too complex
  - **Mitigation:** Keep it simple, focus on common use cases

### Rollback Plan

- Keep builder implementation minimal and derived from Settings
- Builder is optional, Settings remains primary API
- Can remove builder if needed without breaking changes

### Success Metrics / Monitoring

- Track user adoption and feedback in docs issues
- Monitor builder usage vs Settings usage
- User feedback on API discoverability

---

## Related Documents

- [Story 10.0: Series Overview](./10.0-series-overview.md)
- [Story 10.1: Configuration Presets](./10.1.configuration-presets.md)
- [Epic 10: Developer Experience](../prd/epic-10-DX-Experience.md)

---

## Change Log

| Date       | Change                    | Author |
| ---------- | ------------------------- | ------ |
| 2025-01-10 | Migrated to new format    | System |
