# Story 12.16: Production Checklist Documentation

**Status:** Ready
**Priority:** Medium
**Depends on:** None

---

## Context / Background

An external audit (GPT-5.2 assessment, 2026-01-27) identified that production deployment guidance is scattered across multiple documentation files:

> "Add a 'Production checklist' doc that explicitly links: presets vs auto-detect, metrics enablement, diagnostics enablement, and how to validate redaction."
> Evidence: pieces exist across /docs/user-guide/* and /docs/redaction/* but not a single checklist.

Users deploying fapilog to production must currently piece together information from:
- `docs/user-guide/configuration.md` - Presets and settings
- `docs/user-guide/presets.md` - Preset details
- `docs/redaction/testing.md` - Redaction validation
- `docs/redaction/behavior.md` - Redaction limitations
- `docs/troubleshooting/logs-dropped-under-load.md` - Backpressure tuning

A consolidated checklist would reduce friction and prevent production issues.

---

## Scope (In / Out)

### In Scope

- Create `docs/user-guide/production-checklist.md`
- Cover: preset selection, metrics, diagnostics, redaction validation, backpressure
- Link to detailed docs for each topic
- Add to docs navigation/sidebar

### Out of Scope

- Creating new features
- Duplicating content from existing docs (link instead)
- Platform-specific deployment guides (K8s, Lambda, etc.)

---

## Acceptance Criteria

### AC1: Production checklist document exists

**Description:** A consolidated production checklist document is created.

**Validation:**
```bash
test -f docs/user-guide/production-checklist.md
```

### AC2: Covers preset selection

**Description:** Document explains when to use `production` vs `fastapi` vs `serverless` presets, and when to use auto-detect.

**Validation:**
```bash
grep -i "preset" docs/user-guide/production-checklist.md | head -5
```

### AC3: Covers metrics enablement

**Description:** Document explains how to enable and export metrics.

**Validation:**
```bash
grep -i "metrics\|FAPILOG.*METRICS" docs/user-guide/production-checklist.md
```

### AC4: Covers diagnostics enablement

**Description:** Document explains diagnostics system and how to monitor internal fapilog health.

**Validation:**
```bash
grep -i "diagnostics\|FAPILOG.*DIAGNOSTICS" docs/user-guide/production-checklist.md
```

### AC5: Covers redaction validation

**Description:** Document explains how to verify redaction is working before production.

**Validation:**
```bash
grep -i "redact\|test.*redact\|validate.*redact" docs/user-guide/production-checklist.md
```

### AC6: Covers backpressure tuning

**Description:** Document explains queue sizing and backpressure settings for high-load scenarios.

**Validation:**
```bash
grep -i "backpressure\|queue\|DROP_ON_FULL" docs/user-guide/production-checklist.md
```

### AC7: Added to navigation

**Description:** Document is accessible from docs sidebar/navigation.

**Validation:**
```bash
grep -i "production-checklist" docs/index.md || grep -i "production-checklist" docs/user-guide/index.md
```

---

## Implementation Notes

### Document Structure

```markdown
# Production Checklist

Pre-deployment checklist for fapilog in production environments.

## 1. Choose Your Configuration Approach

- [ ] **Preset** or **Auto-detect** or **Custom Settings**?

| Approach | When to Use |
|----------|-------------|
| `preset="production"` | General backend services |
| `preset="fastapi"` | FastAPI applications |
| `preset="serverless"` | AWS Lambda, Cloud Functions |
| `auto_detect=True` | Let fapilog detect environment |
| Custom `Settings()` | Fine-grained control needed |

→ See: [Presets Reference](presets.md)

## 2. Enable Observability

### Metrics

- [ ] Enable metrics collection
- [ ] Configure metrics export endpoint (if using Prometheus)

```bash
export FAPILOG_CORE__ENABLE_METRICS=true
export FAPILOG_METRICS__PORT=9090  # Optional: Prometheus endpoint
```

→ See: [Metrics Guide](metrics.md)

### Diagnostics

- [ ] Understand diagnostics output location (stderr by default)
- [ ] Consider diagnostics log level for production

```bash
export FAPILOG_CORE__DIAGNOSTICS_ENABLED=true
export FAPILOG_CORE__DIAGNOSTICS_MIN_LEVEL=WARNING
```

→ See: [Diagnostics Guide](diagnostics.md)

## 3. Validate Redaction

- [ ] Review what gets redacted vs what doesn't
- [ ] Test redaction with production-like data
- [ ] Decide on `redaction_fail_mode` (warn vs closed)

```python
# Test redaction before deployment
from fapilog import get_logger

logger = get_logger(preset="production")
logger.info("Test", password="secret123", email="user@example.com")
# Verify output shows: password="***", email="***"
```

> **Warning:** Redaction is pattern-based, not content-aware.
> PII in message strings is NOT redacted.

→ See: [Redaction Behavior](../redaction/behavior.md), [Testing Redaction](../redaction/testing.md)

## 4. Configure Backpressure

- [ ] Size queue for expected burst load
- [ ] Decide drop vs wait behavior
- [ ] Monitor for dropped events

```bash
# High-throughput settings
export FAPILOG_CORE__MAX_QUEUE_SIZE=20000
export FAPILOG_CORE__BATCH_MAX_SIZE=256
export FAPILOG_CORE__DROP_ON_FULL=true  # or false to wait
```

→ See: [Troubleshooting Dropped Logs](../troubleshooting/logs-dropped-under-load.md)

## 5. Sink Configuration

- [ ] Configure production sinks (file, HTTP, cloud)
- [ ] Verify sink credentials/endpoints
- [ ] Test sink connectivity

→ See: [Sinks Reference](../plugins/sinks/)

## 6. Graceful Shutdown

- [ ] Ensure application calls `logger.drain()` or uses context manager
- [ ] Verify shutdown handlers are installed (automatic with presets)

```python
# Option 1: Context manager (recommended)
with fapilog.runtime(preset="production") as logger:
    # application code
    pass  # Automatic drain on exit

# Option 2: Manual drain
await logger.drain()
```

→ See: [Graceful Shutdown](../cookbook/graceful-shutdown.md)

## Quick Validation Script

```python
"""Run this script to validate production readiness."""
import asyncio
import fapilog

async def validate_production_config():
    logger = await fapilog.get_async_logger(preset="production")

    # Test basic logging
    await logger.info("Production validation test")

    # Test redaction
    await logger.info("Redaction test", password="SHOULD_BE_MASKED")

    # Test error logging
    try:
        raise ValueError("Test exception")
    except Exception:
        await logger.exception("Exception test")

    # Drain and report
    result = await logger.drain()
    print(f"Validation complete: {result.events_flushed} events flushed")

if __name__ == "__main__":
    asyncio.run(validate_production_config())
```
```

---

## Tasks

- [ ] Create `docs/user-guide/production-checklist.md`
- [ ] Add to `docs/user-guide/index.md` navigation
- [ ] Verify all linked docs exist
- [ ] Run docs build

---

## Definition of Done

### Code Complete

- [ ] Document created with all sections
- [ ] All links valid
- [ ] Added to navigation

### Quality Assurance

- [ ] Docs build passes
- [ ] Manual review of content accuracy
- [ ] Links tested

### Documentation

- [ ] CHANGELOG updated

---

## Related Stories

- **Origin:** GPT-5.2 External Audit (2026-01-27)
- **Related:** Story 12.15 - Architecture docs accuracy

---

## Change Log

| Date | Change | Author |
|------|--------|--------|
| 2026-01-27 | Initial draft from audit findings | Claude |
