


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Redaction Behavior &mdash; fapilog latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=c6e86fd7"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=30646c52"></script>
      <script src="../_static/custom.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Testing Redaction" href="testing.html" />
    <link rel="prev" title="Redaction Configuration" href="configuration.html" />
 


<link rel="canonical" href="https://docs.fapilog.dev/en/stable/redaction/behavior.html" />
<meta name="robots" content="noindex, follow" />


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            fapilog
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/quickstart.html">Quickstart Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/hello-world.html">Hello World Walkthrough</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../why-fapilog.html">Why fapilog?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../comparisons.html">Python Logging Library Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-concepts/index.html">Core Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../core-concepts/pipeline-architecture.html">Pipeline Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-concepts/envelope.html">Envelope</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-concepts/context-binding.html">Context Binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-concepts/batching-backpressure.html">Batching &amp; Backpressure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-concepts/sinks.html">Sinks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-concepts/metrics.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-concepts/diagnostics-resilience.html">Diagnostics Resilience</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-concepts/diagnostics-resilience.html#id1">Diagnostics &amp; Resilience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/presets.html">Configuration Presets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/execution-modes.html">Execution Modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/builder-configuration.html">Configuring Fapilog with the Builder API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/environment-variables.html">Environment Variable Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/production-checklist.html">Production Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/using-logger.html">Using the Logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/context-enrichment.html">Context Enrichment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/rotating-file-sink.html">Rotating File Sink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/sink-routing.html">Sink routing by level</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/sampling.html">Sampling Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/graceful-shutdown.html">Graceful Shutdown</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/performance-tuning.html">Performance Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/benchmarks.html">Performance Benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/integration-guide.html">Integration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/stdlib-bridge.html">stdlib Logging Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/fastapi.html">FastAPI / ASGI Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/reliability-defaults.html">Reliability Defaults and Guardrails</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/testing-plugins.html">Testing Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/webhook-security.html">Webhook Security</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/index.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/fastapi-microservice-production.html">FastAPI Microservices in Production</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/fastapi-json-logging.html">FastAPI JSON logging to stdout (Uvicorn access logs included)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/fastapi-request-id-logging.html">FastAPI request_id logging (correlation ID middleware, concurrency-safe)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/django-structured-logging.html">Django Structured JSON Logging with Correlation IDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/non-blocking-async-logging.html">Non-blocking logging in FastAPI (protect latency under slow sinks)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/dev-prod-logging-config.html">One FastAPI logging config for dev + prod (Uvicorn/Gunicorn)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/redacting-secrets-pii.html">Redacting secrets and PII in FastAPI logs (Authorization, tokens, fields)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/compliance-redaction.html">Compliance Redaction: What Works and What Doesn’t</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/safe-request-response-logging.html">Logging request/response bodies without hanging (safe patterns)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/skip-noisy-endpoints.html">Skipping health/metrics endpoints (noise reduction)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/log-sampling-rate-limiting.html">Log sampling and rate limiting for FastAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/adaptive-sampling-high-volume.html">Adaptive Sampling for High-Volume Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/graceful-shutdown-flush.html">Graceful shutdown &amp; flushing logs (don’t lose logs on deploy)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/exception-logging-request-context.html">Exception logging in FastAPI with request_id + structured context</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/custom-log-levels.html">Custom log levels in Python (TRACE, VERBOSE, NOTICE)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples &amp; Recipes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/builder-configurations.html">Builder Configuration Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/fastapi-logging.html">FastAPI Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/cli-tools.html">Logging in Scripts/CLIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/redacting-secrets.html">Redacting Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/structured-error-logging.html">Structured Error Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/kubernetes-file-sink.html">Kubernetes File Sink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/prometheus-metrics.html">Prometheus Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/sampling-debug-logs.html">Sampling Debug Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/size-limited-destinations.html">Handling Size-Limited Destinations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/cloudwatch_logging/index.html">CloudWatch Logging (LocalStack)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/cloud-sinks/index.html">Cloud Sink Examples</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Redaction</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="presets.html">Redaction Presets</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Redaction Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Redaction Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing Redaction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise.html">Enterprise Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/top-level-functions.html">Top-Level Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/builder.html">Builder API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/logger-methods.html">Logger Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/context-binding.html">Context Binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/audit-trail.html">Audit Trail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/configuration-map.html">Configuration Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/plugins/index.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/lifecycle-results.html">Lifecycle &amp; Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api-reference/modules.html">API Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugin Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plugins/quickstart.html">Plugin Author Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/authoring.html">Authoring Fapilog Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/contracts-and-versioning.html">Plugin Contracts and API Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/redactors.html">Redactors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/sinks.html">Sinks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/enrichers.html">Enrichers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/filters.html">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/processors.html">Processors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/testing.html">Plugin Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/configuration.html">Plugin Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/health-checks.html">Plugin Health Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/error-handling.html">Plugin Error Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../patterns.html">Integration Patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../patterns/sdk-sinks.html">Building SDK-Based Sinks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../patterns/http-sinks.html">Building HTTP-Based Sinks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/logs-dropped-under-load.html">Logs Dropped Under Load</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/destination-size-limits.html">Logs Rejected by Destination Size Limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/context-values-missing.html">Context Values Missing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/file-sink-not-rotating.html">File Sink Not Rotating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/serialization-errors.html">Serialization Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/pii-showing-despite-redaction.html">PII Showing Despite Redaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/cloudwatch-sink.html">CloudWatch Sink Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/loki-sink.html">Loki Sink Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../env-vars.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../settings-guide.html">Settings Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../schema-guide.html">Schema Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../schema-migration-v1.0-to-v1.1.html">Schema Migration Guide: v1.0 to v1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-guide.html">Plugin Catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security-operator-workflows.html">Security Remediation &amp; Approval Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quality-signals.html">Quality Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/settings-to-builder-migration.html">Migrating from Settings to Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/migration-file-rotation.html">Migration Guide: Simplified Rotating File Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/tenacity-integration.html">Tenacity Integration Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/testing.html">Testing with Fapilog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/async-context.html">Async Context Propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../addons/tamper-evident-logging.html">Tamper-Evident Logging Add-on (Optional)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">fapilog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Redaction</a></li>
      <li class="breadcrumb-item active">Redaction Behavior</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/redaction/behavior.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="redaction-behavior">
<h1>Redaction Behavior<a class="headerlink" href="#redaction-behavior" title="Link to this heading"></a></h1>
<p>This page documents exactly what fapilog redacts, how the pipeline works, and known limitations.</p>
<blockquote>
<div><p><strong>Disclaimer:</strong> Redaction is provided as a best-effort mechanism to help protect sensitive data. It matches field names and patterns, not arbitrary field content. You are responsible for testing and verifying redaction meets your compliance requirements before production use. Fapilog and its maintainers accept no liability for data exposure.</p>
</div></blockquote>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Redaction Failure Behavior</strong></p>
<p>By default (<code class="docutils literal notranslate"><span class="pre">redaction_fail_mode=&quot;warn&quot;</span></code>), if the redaction pipeline encounters an unexpected error, the original log event passes through and a diagnostic warning is emitted. For high-security systems handling sensitive data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;closed&quot;</span></code> (high-security): Drop the event entirely rather than risk data exposure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;open&quot;</span></code> (debugging only): Pass event through silently without warning</p></li>
</ul>
<p>Configure via builder:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">with_fallback_redaction</span><span class="p">(</span><span class="n">fail_mode</span><span class="o">=</span><span class="s2">&quot;closed&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Or via settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Settings</span><span class="p">(</span><span class="n">core</span><span class="o">=</span><span class="n">CoreSettings</span><span class="p">(</span><span class="n">redaction_fail_mode</span><span class="o">=</span><span class="s2">&quot;closed&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../user-guide/reliability-defaults.html"><span class="std std-doc">Reliability Defaults</span></a> for related production settings.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
## What Gets Redacted

### Field Mask Redactor

Masks specific field paths under `data.*`. With production/fastapi/serverless presets, the `CREDENTIALS` preset fields are masked:

| Field Pattern | Examples |
|---------------|----------|
| Passwords | `data.password`, `data.passwd`, `data.pwd` |
| Secrets | `data.secret`, `data.api_secret`, `data.client_secret` |
| Tokens | `data.token`, `data.access_token`, `data.refresh_token` |
| API Keys | `data.api_key`, `data.apikey`, `data.api_token` |
| Private Keys | `data.private_key`, `data.secret_key`, `data.signing_key` |
| Auth Headers | `data.authorization`, `data.auth_header` |
| Sessions | `data.session_id`, `data.session_token` |
| OTP Codes | `data.otp`, `data.mfa_code`, `data.verification_code` |

**Example:**
```python
# Input
{&quot;data&quot;: {&quot;password&quot;: &quot;hunter2&quot;, &quot;user&quot;: &quot;alice&quot;}}

# Output
{&quot;data&quot;: {&quot;password&quot;: &quot;***&quot;, &quot;user&quot;: &quot;alice&quot;}}
</pre></div>
</div>
<section id="regex-mask-redactor">
<h2>Regex Mask Redactor<a class="headerlink" href="#regex-mask-redactor" title="Link to this heading"></a></h2>
<p>Matches any field path (at any nesting level) containing sensitive keywords:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pattern</p></th>
<th class="head"><p>Matches</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.*password.*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">user.password</span></code>, <code class="docutils literal notranslate"><span class="pre">auth.password_hash</span></code>, etc.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.*passwd.*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">old_passwd</span></code>, <code class="docutils literal notranslate"><span class="pre">metadata.passwd</span></code>, etc.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.*secret.*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">client_secret</span></code>, <code class="docutils literal notranslate"><span class="pre">secret_key</span></code>, etc.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.*token.*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">access_token</span></code>, <code class="docutils literal notranslate"><span class="pre">refresh_token</span></code>, etc.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.*api.?key.*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">api_key</span></code>, <code class="docutils literal notranslate"><span class="pre">apikey</span></code>, <code class="docutils literal notranslate"><span class="pre">api-key</span></code>, etc.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.*private.?key.*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">private_key</span></code>, <code class="docutils literal notranslate"><span class="pre">privatekey</span></code>, etc.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.*auth.*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">authorization</span></code>, <code class="docutils literal notranslate"><span class="pre">auth_header</span></code>, etc.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.*otp.*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">otp</span></code>, <code class="docutils literal notranslate"><span class="pre">totp_code</span></code>, etc.</p></td>
</tr>
</tbody>
</table>
<p>All patterns are case-insensitive.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input (field path: request.body.user_password)</span>
<span class="p">{</span><span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user_password&quot;</span><span class="p">:</span> <span class="s2">&quot;secret123&quot;</span><span class="p">}}}</span>

<span class="c1"># Output</span>
<span class="p">{</span><span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;user_password&quot;</span><span class="p">:</span> <span class="s2">&quot;***&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
</section>
<section id="url-credentials-redactor">
<h2>URL Credentials Redactor<a class="headerlink" href="#url-credentials-redactor" title="Link to this heading"></a></h2>
<p>Strips userinfo (username:password) from URLs in string values:</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input</span>
<span class="p">{</span><span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://user:pass@api.example.com/v1&quot;</span><span class="p">}</span>

<span class="c1"># Output</span>
<span class="p">{</span><span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://***:***@api.example.com/v1&quot;</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="field-blocker-redactor">
<h2>Field Blocker Redactor<a class="headerlink" href="#field-blocker-redactor" title="Link to this heading"></a></h2>
<p>Blocks high-risk field names by replacing their values entirely. This catches accidental logging of request/response bodies and other bulk data fields.</p>
<p>Default blocked fields: <code class="docutils literal notranslate"><span class="pre">body</span></code>, <code class="docutils literal notranslate"><span class="pre">request_body</span></code>, <code class="docutils literal notranslate"><span class="pre">response_body</span></code>, <code class="docutils literal notranslate"><span class="pre">payload</span></code>, <code class="docutils literal notranslate"><span class="pre">raw</span></code>, <code class="docutils literal notranslate"><span class="pre">dump</span></code>, <code class="docutils literal notranslate"><span class="pre">raw_body</span></code>, <code class="docutils literal notranslate"><span class="pre">raw_request</span></code>, <code class="docutils literal notranslate"><span class="pre">raw_response</span></code>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input</span>
<span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">ssn</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">123-45-6789</span><span class="se">\&quot;</span><span class="s2">}&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">}}</span>

<span class="c1"># Output</span>
<span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="s2">&quot;[REDACTED:HIGH_RISK_FIELD]&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Each blocked field emits a policy-violation diagnostic. Use <code class="docutils literal notranslate"><span class="pre">allowed_fields</span></code> to exempt specific fields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">LoggerBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_redaction</span><span class="p">(</span><span class="n">block_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="string-truncate-redactor">
<h2>String Truncate Redactor<a class="headerlink" href="#string-truncate-redactor" title="Link to this heading"></a></h2>
<p>Truncates string values exceeding a configured length and appends a <code class="docutils literal notranslate"><span class="pre">[truncated]</span></code> marker. Disabled by default (<code class="docutils literal notranslate"><span class="pre">max_string_length=None</span></code>).</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># With max_string_length=50</span>
<span class="c1"># Input</span>
<span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="s2">&quot;a]&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">}}</span>

<span class="c1"># Output</span>
<span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="s2">&quot;a]a]a]...a]a][truncated]&quot;</span><span class="p">}}</span>  <span class="c1"># truncated to 50 chars + marker</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">LoggerBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_redaction</span><span class="p">(</span><span class="n">max_string_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="what-does-not-get-redacted">
<h2>What Does NOT Get Redacted<a class="headerlink" href="#what-does-not-get-redacted" title="Link to this heading"></a></h2>
<section id="pii-in-message-strings">
<h3>PII in Message Strings<a class="headerlink" href="#pii-in-message-strings" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ❌ NOT redacted - PII in message</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User email: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Output: {&quot;message&quot;: &quot;User email: john@example.com&quot;}</span>

<span class="c1"># ✅ Redacted - PII in named field</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User&quot;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>
<span class="c1"># Output: {&quot;data&quot;: {&quot;email&quot;: &quot;***&quot;}}</span>
</pre></div>
</div>
</section>
<section id="arbitrarily-named-fields">
<h3>Arbitrarily-Named Fields<a class="headerlink" href="#arbitrarily-named-fields" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ❌ NOT redacted - field name doesn&#39;t match</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Contact&quot;</span><span class="p">,</span> <span class="n">customer_contact</span><span class="o">=</span><span class="s2">&quot;john@example.com&quot;</span><span class="p">)</span>
<span class="c1"># Output: {&quot;data&quot;: {&quot;customer_contact&quot;: &quot;john@example.com&quot;}}</span>

<span class="c1"># ✅ Redacted - recognized field name</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Contact&quot;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&quot;john@example.com&quot;</span><span class="p">)</span>
<span class="c1"># Output: {&quot;data&quot;: {&quot;email&quot;: &quot;***&quot;}}</span>
</pre></div>
</div>
</section>
<section id="serialized-json-strings">
<h3>Serialized JSON Strings<a class="headerlink" href="#serialized-json-strings" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ❌ NOT redacted - JSON as string</span>
<span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;{&quot;email&quot;: &quot;john@example.com&quot;}&#39;</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
<span class="c1"># Output: {&quot;data&quot;: {&quot;payload&quot;: &quot;{\&quot;email\&quot;: \&quot;john@example.com\&quot;}&quot;}}</span>

<span class="c1"># ✅ Redacted - pass as dict</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&quot;john@example.com&quot;</span><span class="p">)</span>
<span class="c1"># Output: {&quot;data&quot;: {&quot;email&quot;: &quot;***&quot;}}</span>
</pre></div>
</div>
</section>
</section>
<section id="pipeline-order">
<h2>Pipeline Order<a class="headerlink" href="#pipeline-order" title="Link to this heading"></a></h2>
<p>Redaction runs in the logger worker loop before envelope serialization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Log Event → Enrichers → Redactors → Serialization → Sinks
</pre></div>
</div>
<p>Redactors execute in order:</p>
<ol class="arabic simple">
<li><p><strong>field_mask</strong> - Exact path matching first</p></li>
<li><p><strong>regex_mask</strong> - Pattern matching second</p></li>
<li><p><strong>url_credentials</strong> - URL sanitization</p></li>
<li><p><strong>field_blocker</strong> - High-risk field blocking</p></li>
<li><p><strong>string_truncate</strong> - Long string truncation last</p></li>
</ol>
<p>This order ensures explicit masking takes precedence, followed by broader patterns, URL cleanup, policy enforcement, and finally size control. The <code class="docutils literal notranslate"><span class="pre">production</span></code>, <code class="docutils literal notranslate"><span class="pre">fastapi</span></code>, and <code class="docutils literal notranslate"><span class="pre">serverless</span></code> presets enable the first three; the <code class="docutils literal notranslate"><span class="pre">hardened</span></code> preset also enables <code class="docutils literal notranslate"><span class="pre">field_blocker</span></code>.</p>
</section>
<section id="guardrails">
<span id="id1"></span><h2>Guardrails<a class="headerlink" href="#guardrails" title="Link to this heading"></a></h2>
<p>Redaction includes safety limits to prevent performance issues with deeply nested or large objects. There are two levels of guardrails: <strong>core pipeline guardrails</strong> that apply globally, and <strong>per-redactor guardrails</strong> that each redactor can configure.</p>
<section id="core-pipeline-guardrails">
<h3>Core Pipeline Guardrails<a class="headerlink" href="#core-pipeline-guardrails" title="Link to this heading"></a></h3>
<p>These settings apply as outer limits across all redactors:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Setting</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">core.redaction_max_depth</span></code></p></td>
<td><p>6</p></td>
<td><p>Maximum nesting level for all redactors</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">core.redaction_max_keys_scanned</span></code></p></td>
<td><p>5000</p></td>
<td><p>Maximum keys scanned across all redactors</p></td>
</tr>
</tbody>
</table>
<p>Configure via builder:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">LoggerBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_core</span><span class="p">(</span><span class="n">redaction_max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">redaction_max_keys_scanned</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Or via settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Settings</span><span class="p">(</span><span class="n">core</span><span class="o">=</span><span class="n">CoreSettings</span><span class="p">(</span><span class="n">redaction_max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">redaction_max_keys_scanned</span><span class="o">=</span><span class="mi">10000</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="per-redactor-guardrails">
<h3>Per-Redactor Guardrails<a class="headerlink" href="#per-redactor-guardrails" title="Link to this heading"></a></h3>
<p>Each redactor has its own guardrails (used when less restrictive than core):</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Setting</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code></p></td>
<td><p>16</p></td>
<td><p>Per-redactor traversal limit</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max_keys_scanned</span></code></p></td>
<td><p>1000</p></td>
<td><p>Per-redactor key limit</p></td>
</tr>
</tbody>
</table>
<p>Configure via builder:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logger</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">LoggerBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_redaction</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">max_keys</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="guardrail-precedence">
<h3>Guardrail Precedence<a class="headerlink" href="#guardrail-precedence" title="Link to this heading"></a></h3>
<p>The <strong>more restrictive</strong> value always applies:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Core Setting</p></th>
<th class="head"><p>Plugin Setting</p></th>
<th class="head"><p>Effective Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">max_depth=6</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">max_depth=16</span></code></p></td>
<td><p>6 (core wins)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max_depth=20</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">max_depth=5</span></code></p></td>
<td><p>5 (plugin wins)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">max_depth=None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">max_depth=16</span></code></p></td>
<td><p>16 (plugin default)</p></td>
</tr>
</tbody>
</table>
<p>This ensures that core guardrails act as hard limits that cannot be exceeded by individual redactor configurations.</p>
</section>
<section id="guardrail-behavior-on-guardrail-exceeded">
<h3>Guardrail Behavior (<code class="docutils literal notranslate"><span class="pre">on_guardrail_exceeded</span></code>)<a class="headerlink" href="#guardrail-behavior-on-guardrail-exceeded" title="Link to this heading"></a></h3>
<p>All tree-traversing redactors support configurable behavior when guardrails are exceeded via the <code class="docutils literal notranslate"><span class="pre">on_guardrail_exceeded</span></code> option:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Mode</p></th>
<th class="head"><p>Behavior</p></th>
<th class="head"><p>Use Case</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;warn&quot;</span></code></p></td>
<td><p>Emit diagnostic, continue with partial redaction</p></td>
<td><p>Development, debugging</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;drop&quot;</span></code></p></td>
<td><p>Emit diagnostic, drop the entire event</p></td>
<td><p>High-security compliance</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;replace_subtree&quot;</span></code> (default for field_mask)</p></td>
<td><p>Emit diagnostic, replace unscanned subtree with mask</p></td>
<td><p>Balanced security/availability</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">field_blocker</span></code> and <code class="docutils literal notranslate"><span class="pre">string_truncate</span></code> only support <code class="docutils literal notranslate"><span class="pre">&quot;warn&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;drop&quot;</span></code> — they do not support <code class="docutils literal notranslate"><span class="pre">&quot;replace_subtree&quot;</span></code>.</p>
</div></blockquote>
<p>To opt into fail-open behavior for debugging:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">fapilog.plugins.redactors.field_mask</span><span class="w"> </span><span class="kn">import</span> <span class="n">FieldMaskConfig</span>

<span class="n">Settings</span><span class="p">(</span>
    <span class="n">redactor_config</span><span class="o">=</span><span class="n">RedactorConfig</span><span class="p">(</span>
        <span class="n">field_mask</span><span class="o">=</span><span class="n">FieldMaskConfig</span><span class="p">(</span>
            <span class="n">fields_to_mask</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">on_guardrail_exceeded</span><span class="o">=</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span>  <span class="c1"># Fail-open for debugging</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Trade-offs:</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Mode</p></th>
<th class="head"><p>Security</p></th>
<th class="head"><p>Availability</p></th>
<th class="head"><p>Data Loss</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;warn&quot;</span></code></p></td>
<td><p>Low (unredacted data may leak)</p></td>
<td><p>High (events pass through)</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;drop&quot;</span></code></p></td>
<td><p>High (no unredacted data)</p></td>
<td><p>Low (events dropped)</p></td>
<td><p>Full event</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;replace_subtree&quot;</span></code></p></td>
<td><p>Medium (subtree masked)</p></td>
<td><p>Medium (event preserved)</p></td>
<td><p>Subtree only</p></td>
</tr>
</tbody>
</table>
<p><strong>Example with <code class="docutils literal notranslate"><span class="pre">replace_subtree</span></code>:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Event with depth exceeding max_depth=2</span>
<span class="n">event</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;level1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;secret&quot;</span><span class="p">}}}}</span>

<span class="c1"># Result: unscanned subtree replaced with mask</span>
<span class="p">{</span><span class="s2">&quot;level1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level2&quot;</span><span class="p">:</span> <span class="s2">&quot;***&quot;</span><span class="p">}}</span>
</pre></div>
</div>
</section>
</section>
<section id="failure-handling">
<h2>Failure Handling<a class="headerlink" href="#failure-handling" title="Link to this heading"></a></h2>
<p>Fapilog provides multiple layers of redaction failure protection:</p>
<section id="redaction-settings-relationship">
<h3>Redaction Settings Relationship<a class="headerlink" href="#redaction-settings-relationship" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Setting</p></th>
<th class="head"><p>Scope</p></th>
<th class="head"><p>Purpose</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">redactor_config.field_mask.block_on_unredactable</span></code></p></td>
<td><p>Per-redactor</p></td>
<td><p>Drop event when redactor can’t process a value</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">redactor_config.field_mask.on_guardrail_exceeded</span></code></p></td>
<td><p>Per-redactor</p></td>
<td><p>Behavior when depth/keys guardrails hit</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;replace_subtree&quot;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">core.fallback_redact_mode</span></code></p></td>
<td><p>Fallback sink</p></td>
<td><p>How to redact payloads on stderr fallback</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;minimal&quot;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">core.redaction_fail_mode</span></code></p></td>
<td><p>Global pipeline</p></td>
<td><p>What to do when <code class="docutils literal notranslate"><span class="pre">_apply_redactors()</span></code> throws</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;warn&quot;</span></code></p></td>
</tr>
</tbody>
</table>
<p>All redaction settings default to <strong>fail-closed</strong> behavior to prevent PII leakage. To opt into fail-open behavior for debugging, explicitly set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">block_on_unredactable=False</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on_guardrail_exceeded=&quot;warn&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redaction_fail_mode=&quot;open&quot;</span></code></p></li>
</ul>
</section>
<section id="per-redactor-behavior-block-on-unredactable">
<h3>Per-Redactor Behavior (<code class="docutils literal notranslate"><span class="pre">block_on_unredactable</span></code>)<a class="headerlink" href="#per-redactor-behavior-block-on-unredactable" title="Link to this heading"></a></h3>
<p>Individual redactors can block on unparseable values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">with_redaction</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">],</span> <span class="n">block_on_unredactable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>When a redactor encounters a value it cannot process:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code> (default): Log event is dropped, diagnostic warning emitted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code>: Original value preserved, diagnostic warning emitted</p></li>
</ul>
</section>
<section id="global-pipeline-behavior-redaction-fail-mode">
<h3>Global Pipeline Behavior (<code class="docutils literal notranslate"><span class="pre">redaction_fail_mode</span></code>)<a class="headerlink" href="#global-pipeline-behavior-redaction-fail-mode" title="Link to this heading"></a></h3>
<p>Controls what happens when the entire redaction pipeline fails unexpectedly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Production/FastAPI/Serverless presets default to &quot;warn&quot;</span>
<span class="n">Settings</span><span class="p">(</span><span class="n">preset</span><span class="o">=</span><span class="s2">&quot;production&quot;</span><span class="p">)</span>  <span class="c1"># redaction_fail_mode=&quot;warn&quot;</span>

<span class="c1"># Explicit configuration</span>
<span class="n">Settings</span><span class="p">(</span><span class="n">core</span><span class="o">=</span><span class="n">CoreSettings</span><span class="p">(</span><span class="n">redaction_fail_mode</span><span class="o">=</span><span class="s2">&quot;closed&quot;</span><span class="p">))</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Mode</p></th>
<th class="head"><p>Behavior</p></th>
<th class="head"><p>Use Case</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;open&quot;</span></code></p></td>
<td><p>Pass original event through</p></td>
<td><p>Development, debugging</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;warn&quot;</span></code></p></td>
<td><p>Pass event through + emit diagnostic</p></td>
<td><p>Production (default)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;closed&quot;</span></code></p></td>
<td><p>Drop event entirely</p></td>
<td><p>High-security compliance</p></td>
</tr>
</tbody>
</table>
</section>
<section id="fallback-redaction-fallback-redact-mode">
<h3>Fallback Redaction (<code class="docutils literal notranslate"><span class="pre">fallback_redact_mode</span></code>)<a class="headerlink" href="#fallback-redaction-fallback-redact-mode" title="Link to this heading"></a></h3>
<p>When a sink fails and falls back to stderr, this controls redaction:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Mode</p></th>
<th class="head"><p>Behavior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;minimal&quot;</span></code></p></td>
<td><p>Apply built-in sensitive field masking (default)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;inherit&quot;</span></code></p></td>
<td><p>Use pipeline redactors (requires pipeline context)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code></p></td>
<td><p>No redaction (opt-in to legacy behavior, emits warning)</p></td>
</tr>
</tbody>
</table>
<p>For serialized payloads, <code class="docutils literal notranslate"><span class="pre">&quot;minimal&quot;</span></code> mode deserializes, redacts, and re-serializes. If JSON parsing fails, raw output is written with a diagnostic warning.</p>
</section>
</section>
<section id="nested-objects-and-arrays">
<h2>Nested Objects and Arrays<a class="headerlink" href="#nested-objects-and-arrays" title="Link to this heading"></a></h2>
<p>Redaction traverses nested structures:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Nested objects - redacted</span>
<span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;x@y.com&quot;</span><span class="p">}}}</span>
<span class="c1"># → {&quot;user&quot;: {&quot;profile&quot;: {&quot;email&quot;: &quot;***&quot;}}}</span>

<span class="c1"># Arrays - each element checked</span>
<span class="p">{</span><span class="s2">&quot;users&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;a@b.com&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;c@d.com&quot;</span><span class="p">}]}</span>
<span class="c1"># → {&quot;users&quot;: [{&quot;email&quot;: &quot;***&quot;}, {&quot;email&quot;: &quot;***&quot;}]}</span>
</pre></div>
</div>
<p>Wildcard patterns in field paths:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">with_redaction</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;users[*].email&quot;</span><span class="p">])</span>  <span class="c1"># All emails in users array</span>
<span class="o">.</span><span class="n">with_redaction</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;data.*.secret&quot;</span><span class="p">])</span>   <span class="c1"># Any secret under data</span>
</pre></div>
</div>
</section>
<section id="deterministic-behavior">
<h2>Deterministic Behavior<a class="headerlink" href="#deterministic-behavior" title="Link to this heading"></a></h2>
<p>For the same input and configuration:</p>
<ul class="simple">
<li><p>Redaction is deterministic</p></li>
<li><p>Field order is preserved</p></li>
<li><p>Mask string is consistent</p></li>
</ul>
<p>This ensures logs are predictable and testable.</p>
</section>
<section id="bypass-unsafe-debug">
<span id="unsafe-debug-escape-hatch"></span><h2>Bypass: unsafe_debug()<a class="headerlink" href="#bypass-unsafe-debug" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">unsafe_debug()</span></code> method emits a DEBUG-level event that <strong>skips the entire redaction pipeline</strong>. It exists for cases where developers need to inspect raw data during local debugging.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sync</span>
<span class="n">logger</span><span class="o">.</span><span class="n">unsafe_debug</span><span class="p">(</span><span class="s2">&quot;raw request&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">request_body</span><span class="p">)</span>

<span class="c1"># Async</span>
<span class="k">await</span> <span class="n">logger</span><span class="o">.</span><span class="n">unsafe_debug</span><span class="p">(</span><span class="s2">&quot;raw request&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">request_body</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p><strong>Never use <code class="docutils literal notranslate"><span class="pre">unsafe_debug()</span></code> in production code.</strong> Events emitted through this method bypass all redaction, including field masking, regex masking, URL credential stripping, and field blocking. Sensitive data will appear in plain text in your logs.</p>
</div>
<p><strong>How it works:</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">unsafe_debug()</span></code> injects an internal sentinel object (<code class="docutils literal notranslate"><span class="pre">_UNSAFE_SENTINEL</span></code>) into the event metadata</p></li>
<li><p>The envelope builder checks for the sentinel by identity (not value) and sets a <code class="docutils literal notranslate"><span class="pre">_fapilog_unsafe=True</span></code> marker on the envelope</p></li>
<li><p>The worker’s redaction step checks for this marker and skips redaction entirely</p></li>
<li><p>User-supplied <code class="docutils literal notranslate"><span class="pre">_fapilog_unsafe=True</span></code> kwargs are stripped — only the method can set the sentinel</p></li>
</ol>
<p><strong>Restrictions:</strong></p>
<ul class="simple">
<li><p>Logs at <strong>DEBUG level only</strong> — will not appear with INFO or higher log levels in production</p></li>
<li><p>Intentionally named <code class="docutils literal notranslate"><span class="pre">unsafe_debug</span></code> to be visible in code review and <code class="docutils literal notranslate"><span class="pre">grep</span></code></p></li>
<li><p>Cannot be triggered by passing metadata kwargs; the sentinel is an internal <code class="docutils literal notranslate"><span class="pre">object()</span></code> instance</p></li>
</ul>
</section>
<section id="related">
<h2>Related<a class="headerlink" href="#related" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="presets.html"><span class="std std-doc">Presets Reference</span></a> - Complete field lists</p></li>
<li><p><a class="reference internal" href="configuration.html"><span class="std std-doc">Configuration</span></a> - How to configure</p></li>
<li><p><a class="reference internal" href="testing.html"><span class="std std-doc">Testing</span></a> - Verify redaction in CI</p></li>
<li><p><a class="reference internal" href="../cookbook/compliance-redaction.html"><span class="std std-doc">Compliance Cookbook</span></a> - What works and what doesn’t</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          
<footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer" style="position: relative;">
        <a href="configuration.html" class="btn btn-neutral float-left" title="Redaction Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="testing.html" class="btn btn-neutral float-right" title="Testing Redaction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      <div style="position: absolute; left: 50%; transform: translateX(-50%); top: 50%; margin-top: -0.5em;">
        <a href="https://fapilog.dev">www.fapilog.dev</a>
      </div>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Chris Haste.
      <span class="lastupdated">Last updated on February 07, 2026.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>